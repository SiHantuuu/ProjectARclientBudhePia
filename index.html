<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <title>Museum Joystick Mode</title>

    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
    <script src="https://unpkg.com/aframe-environment-component@1.3.3/dist/aframe-environment-component.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/nipplejs/0.10.1/nipplejs.min.js"></script>

    <style>
      body {
        margin: 0;
        overflow: hidden;
        user-select: none;
        -webkit-user-select: none;
      }

      /* Area Joystick (Kiri Bawah) */
      #joystick-zone {
        position: absolute;
        bottom: 20px;
        left: 20px;
        width: 150px;
        height: 150px;
        z-index: 999;
        /* Area ini tidak boleh menggerakkan kamera */
        touch-action: none;
      }

      /* Instruksi */
      #instruction {
        position: fixed;
        top: 10px;
        width: 100%;
        text-align: center;
        color: white;
        font-family: sans-serif;
        pointer-events: none;
        text-shadow: 1px 1px 2px black;
        font-size: 14px;
        z-index: 900;
      }

      /* Popup Info */
      #info-overlay {
        display: none;
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 80%;
        max-width: 350px;
        background: rgba(0, 0, 0, 0.9);
        color: white;
        padding: 20px;
        border-radius: 15px;
        border: 2px solid #00d2ff;
        z-index: 1000;
        font-family: sans-serif;
        text-align: center;
      }
      .close-btn {
        background: #ff4444;
        color: white;
        border: none;
        padding: 10px 20px;
        margin-top: 15px;
        border-radius: 50px;
        font-weight: bold;
        cursor: pointer;
      }
    </style>
  </head>
  <body>
    <div id="instruction">
      üïπÔ∏è KIRI: Joystick Jalan | üëã KANAN: Geser Nengok | üëÜ TAP: Klik Objek
    </div>

    <div id="joystick-zone"></div>

    <div id="info-overlay">
      <h2 id="info-title" style="color: #00d2ff; margin-top: 0">Judul</h2>
      <p id="info-desc">Deskripsi...</p>
      <button class="close-btn" onclick="tutupInfo()">TUTUP</button>
    </div>

    <a-scene
      vr-mode-ui="enabled: false"
      cursor="rayOrigin: mouse"
      raycaster="objects: .clickable"
    >
      <a-assets>
        <a-asset-item
          id="model-bebek"
          src="https://raw.githubusercontent.com/KhronosGroup/glTF-Sample-Models/master/2.0/Duck/glTF-Binary/Duck.glb"
        ></a-asset-item>
      </a-assets>

      <a-entity
        environment="preset: contact; skyType: atmosphere; groundColor: #333; grid: none"
      ></a-entity>

      <a-entity id="rig" position="0 0 5" rotation="0 0 0">
        <a-entity
          id="camera"
          camera
          look-controls="touchEnabled: true"
          position="0 1.6 0"
        ></a-entity>
      </a-entity>

      <a-entity
        class="clickable"
        gltf-model="#model-bebek"
        position="0 0.5 0"
        scale="1 1 1"
        animation="property: rotation; to: 0 360 0; loop: true; dur: 8000; easing: linear"
        onclick="bukaInfo('Si Bebek', 'Ini adalah model GLB. Tinggal ganti dengan file pelampung.glb kamu.')"
      >
      </a-entity>
      <a-cylinder
        position="0 0.1 0"
        radius="1"
        height="0.2"
        color="#222"
      ></a-cylinder>

      <a-entity position="-3 0 -3">
        <a-torus
          class="clickable"
          color="orange"
          radius="0.5"
          radius-tubular="0.15"
          position="0 1.5 0"
          rotation="0 45 0"
          onclick="bukaInfo('Pelampung Cincin', 'Pelampung standar keselamatan. Tap pada benda ini lebih mudah sekarang.')"
        >
        </a-torus>
        <a-cylinder
          position="0 0.1 0"
          radius="0.8"
          height="0.2"
          color="#222"
        ></a-cylinder>
      </a-entity>
    </a-scene>

    <script>
      /* --- 1. SETUP JOYSTICK (NIPPLE.JS) --- */
      const joystickZone = document.getElementById("joystick-zone");

      // Buat Joystick
      const manager = nipplejs.create({
        zone: joystickZone,
        mode: "static",
        position: { left: "50%", top: "50%" },
        color: "white",
        size: 100,
      });

      /* --- 2. LOGIKA PERGERAKAN --- */
      let moveData = { x: 0, y: 0 }; // Menyimpan data arah joystick
      let isMoving = false;
      const speed = 0.1; // Kecepatan jalan

      // Saat Joystick Digerakkan
      manager.on("move", function (evt, data) {
        if (data && data.vector) {
          moveData.x = data.vector.x; // Kiri-Kanan
          moveData.y = data.vector.y; // Maju-Mundur
          isMoving = true;
        }
      });

      // Saat Joystick Dilepas
      manager.on("end", function () {
        isMoving = false;
        moveData = { x: 0, y: 0 };
      });

      // Loop Game (Dijalankan setiap frame layar)
      const rig = document.getElementById("rig");
      const camera = document.getElementById("camera");

      function gameLoop() {
        if (isMoving) {
          // 1. Ambil arah hadap kamera (rotasi Y)
          const rotation = camera.getAttribute("rotation");
          const angleRad = rotation.y * (Math.PI / 180); // Ubah ke radian

          // 2. Hitung matematika pergerakan (Sin/Cos)
          // Maju Mundur (Y Joystick)
          const dx = Math.sin(angleRad) * -moveData.y * speed;
          const dz = Math.cos(angleRad) * -moveData.y * speed;

          // Geser Kiri Kanan (X Joystick) - optional, biar kayak game FPS
          const sx = Math.cos(angleRad) * moveData.x * speed;
          const sz = Math.sin(angleRad) * -moveData.x * speed;

          // 3. Terapkan ke posisi Rig
          rig.object3D.position.x += dx + sx;
          rig.object3D.position.z += dz + sz;
        }
        requestAnimationFrame(gameLoop);
      }

      // Jalankan Loop
      gameLoop();

      /* --- 3. INTERAKSI KLIK --- */
      const infoOverlay = document.getElementById("info-overlay");
      const titleEl = document.getElementById("info-title");
      const descEl = document.getElementById("info-desc");

      // Fungsi Global untuk dipanggil di HTML onclick=""
      window.bukaInfo = function (judul, deskripsi) {
        // Animasi kecil biar kerasa ngeklik
        titleEl.innerText = judul;
        descEl.innerText = deskripsi;
        infoOverlay.style.display = "block";
      };

      window.tutupInfo = function () {
        infoOverlay.style.display = "none";
      };

      // Mencegah Joystick menggerakkan kamera A-Frame
      joystickZone.addEventListener(
        "touchmove",
        function (e) {
          e.stopPropagation();
        },
        false
      );
    </script>
  </body>
</html>
