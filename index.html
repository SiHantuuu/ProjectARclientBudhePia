<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <title>Magic Window VR</title>
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
    <script src="https://unpkg.com/aframe-environment-component@1.3.3/dist/aframe-environment-component.min.js"></script>

    <style>
      /* Tombol Izin Sensor (Wajib untuk iPhone) */
      #start-btn {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.9);
        z-index: 9999;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        color: white;
        font-family: sans-serif;
      }
      .btn-besar {
        padding: 20px 40px;
        background: #00d2ff;
        border: none;
        border-radius: 50px;
        font-size: 20px;
        font-weight: bold;
        margin-top: 20px;
        cursor: pointer;
      }

      /* Kotak Info */
      #info-box {
        position: fixed;
        bottom: 30px;
        left: 50%;
        transform: translateX(-50%);
        width: 90%;
        max-width: 400px;
        background: rgba(0, 0, 0, 0.8);
        color: white;
        padding: 20px;
        border-radius: 15px;
        border: 2px solid #ff6b00;
        display: none;
        text-align: center;
        font-family: sans-serif;
        pointer-events: auto;
      }
    </style>
  </head>
  <body>
    <div id="start-btn">
      <h1>ðŸ”­ Mode Jendela Ajaib</h1>
      <p>Gerakkan HP untuk melihat sekeliling</p>
      <button class="btn-besar" onclick="mulaiExperience()">MULAI</button>
    </div>

    <div id="info-box">
      <h3 id="judul-info" style="margin-top: 0; color: #ff6b00">Judul</h3>
      <p id="deskripsi-info">Deskripsi</p>
      <button
        onclick="tutupInfo()"
        style="
          padding: 10px 20px;
          background: #555;
          color: white;
          border: none;
          border-radius: 5px;
        "
      >
        Tutup
      </button>
    </div>

    <a-scene
      vr-mode-ui="enabled: false"
      cursor="rayOrigin: mouse"
      raycaster="objects: .dapat-diklik"
    >
      <a-assets>
        <a-asset-item
          id="model-bebek"
          src="https://raw.githubusercontent.com/KhronosGroup/glTF-Sample-Models/master/2.0/Duck/glTF-Binary/Duck.glb"
        ></a-asset-item>
      </a-assets>

      <a-entity
        environment="preset: starry; groundColor: #222; lighting: point; skyType: atmosphere;"
      ></a-entity>

      <a-entity id="rig" position="0 0 4">
        <a-camera
          id="cam"
          look-controls="touchEnabled: false; magicWindowTrackingEnabled: true"
          wasd-controls-enabled="false"
        >
        </a-camera>
      </a-entity>

      <a-entity
        class="dapat-diklik"
        gltf-model="#model-bebek"
        position="0 1 0"
        scale="1.5 1.5 1.5"
        animation="property: rotation; to: 0 360 0; loop: true; dur: 8000; easing: linear"
        onclick="tampilkanInfo('Pelampung Bebek', 'Bebek ini adalah contoh model. Silakan ganti dengan pelampung keselamatanmu.')"
      >
      </a-entity>

      <a-text
        value="TAP SAYA!"
        position="0 2.5 0"
        align="center"
        color="yellow"
        animation="property: position; dir: alternate; to: 0 2.7 0; loop: true; dur: 1000"
      ></a-text>

      <a-circle
        class="dapat-diklik"
        position="-3 0.1 2"
        rotation="-90 0 0"
        radius="0.5"
        color="#00d2ff"
        onclick="pindahPosisi(-3, 2)"
      >
        <a-text
          value="Pindah Sini"
          align="center"
          position="0 0 0.2"
          color="black"
          scale="0.5 0.5 0.5"
        ></a-text>
      </a-circle>

      <a-circle
        class="dapat-diklik"
        position="3 0.1 2"
        rotation="-90 0 0"
        radius="0.5"
        color="#00d2ff"
        onclick="pindahPosisi(3, 2)"
      >
        <a-text
          value="Pindah Sini"
          align="center"
          position="0 0 0.2"
          color="black"
          scale="0.5 0.5 0.5"
        ></a-text>
      </a-circle>

      <a-circle
        class="dapat-diklik"
        position="0 0.1 4"
        rotation="-90 0 0"
        radius="0.5"
        color="#ff0055"
        onclick="pindahPosisi(0, 4)"
      >
        <a-text
          value="Reset"
          align="center"
          position="0 0 0.2"
          color="white"
          scale="0.5 0.5 0.5"
        ></a-text>
      </a-circle>
    </a-scene>

    <script>
      function mulaiExperience() {
        // Hilangkan layar start
        document.getElementById("start-btn").style.display = "none";

        // Minta Izin Sensor (Khusus iPhone/iOS 13+)
        // Android biasanya otomatis jalan
        if (
          typeof DeviceOrientationEvent !== "undefined" &&
          typeof DeviceOrientationEvent.requestPermission === "function"
        ) {
          DeviceOrientationEvent.requestPermission()
            .then((response) => {
              if (response == "granted") {
                console.log("Sensor Diizinkan");
              }
            })
            .catch(console.error);
        }
      }

      // Fungsi Teleport
      function pindahPosisi(x, z) {
        const rig = document.getElementById("rig");
        // Geser posisi kamera
        rig.setAttribute("position", { x: x, y: 0, z: z });

        // Efek suara atau feedback (opsional)
        console.log("Pindah ke", x, z);
      }

      // Fungsi Info
      const infoBox = document.getElementById("info-box");
      const judul = document.getElementById("judul-info");
      const desk = document.getElementById("deskripsi-info");

      window.tampilkanInfo = function (j, d) {
        judul.innerText = j;
        desk.innerText = d;
        infoBox.style.display = "block";
      };

      window.tutupInfo = function () {
        infoBox.style.display = "none";
      };
    </script>
  </body>
</html>
