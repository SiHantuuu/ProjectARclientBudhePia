<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <title>Museum Virtual Pelampung</title>
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/c-frame/aframe-extras@7.0.0/dist/aframe-extras.min.js"></script>
    <script src="https://unpkg.com/aframe-environment-component@1.3.3/dist/aframe-environment-component.min.js"></script>

    <style>
      /* UI Tombol Maju (Khusus HP) */
      #mobile-controls {
        position: fixed;
        bottom: 30px;
        left: 30px;
        z-index: 999;
        display: none; /* Otomatis muncul lewat JS deteksi HP */
      }
      .move-btn {
        width: 80px;
        height: 80px;
        background: rgba(255, 255, 255, 0.3);
        border: 2px solid white;
        border-radius: 50%;
        color: white;
        font-size: 30px;
        display: flex;
        align-items: center;
        justify-content: center;
        user-select: none;
        touch-action: manipulation;
      }
      .move-btn:active {
        background: rgba(0, 255, 0, 0.5);
      }

      /* UI Penjelasan (Popup Info) */
      #info-box {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 80%;
        max-width: 400px;
        background: rgba(0, 0, 0, 0.9);
        color: white;
        padding: 20px;
        border-radius: 10px;
        border: 2px solid #00d2ff;
        display: none;
        z-index: 1000;
        text-align: center;
        font-family: sans-serif;
      }
      .close-btn {
        margin-top: 15px;
        padding: 10px 20px;
        background: #ff0055;
        border: none;
        color: white;
        font-weight: bold;
        cursor: pointer;
        border-radius: 5px;
      }

      /* Crosshair (Titik tengah) */
      #crosshair {
        position: fixed;
        top: 50%;
        left: 50%;
        width: 10px;
        height: 10px;
        background: white;
        border-radius: 50%;
        transform: translate(-50%, -50%);
        pointer-events: none;
        z-index: 900;
        opacity: 0.7;
        mix-blend-mode: difference;
      }
    </style>
  </head>
  <body>
    <div id="crosshair"></div>

    <div id="mobile-controls">
      <div class="move-btn" id="btn-forward">⬆️</div>
    </div>

    <div id="info-box">
      <h2 id="info-title">Judul</h2>
      <p id="info-desc">Deskripsi...</p>
      <button class="close-btn" onclick="tutupInfo()">TUTUP</button>
    </div>

    <a-scene renderer="antialias: true" vr-mode-ui="enabled: false">
      <a-assets>
        <a-asset-item
          id="model-bebek"
          src="https://raw.githubusercontent.com/KhronosGroup/glTF-Sample-Models/master/2.0/Duck/glTF-Binary/Duck.glb"
        ></a-asset-item>
      </a-assets>

      <a-entity
        environment="preset: threetowers; skyType: atmosphere; lighting: point; groundColor: #444; grid: 1x1"
      ></a-entity>

      <a-entity
        id="rig"
        movement-controls="speed: 0.15; constrainToNavMesh: false"
        position="0 0 5"
      >
        <a-entity
          camera
          position="0 1.6 0"
          look-controls="pointerLockEnabled: true"
        >
          <a-entity
            cursor="fuse: false; rayOrigin: entity"
            position="0 0 -1"
            geometry="primitive: ring; radiusInner: 0.02; radiusOuter: 0.03"
            material="color: black; shader: flat"
            raycaster="objects: .clickable"
          >
          </a-entity>
        </a-entity>
      </a-entity>

      <a-box
        position="0 0.5 0"
        color="#333"
        width="1"
        height="1"
        depth="1"
      ></a-box>
      <a-entity
        class="clickable"
        gltf-model="#model-bebek"
        position="0 1 0"
        scale="1 1 1"
        animation="property: rotation; to: 0 360 0; loop: true; dur: 8000; easing: linear"
        onclick="bukaInfo('Pelampung Bebek', 'Ini adalah contoh model GLB. Bebek ini bisa kamu ganti dengan file pelampung.glb milikmu.')"
      >
      </a-entity>

      <a-box
        position="-3 0.5 -2"
        color="#333"
        width="1"
        height="1"
        depth="1"
      ></a-box>
      <a-torus
        class="clickable"
        position="-3 1.5 -2"
        color="orange"
        radius="0.4"
        radius-tubular="0.1"
        animation="property: position; dir: alternate; to: -3 1.7 -2; loop: true; dur: 1000"
        onclick="bukaInfo('Pelampung Ring', 'Pelampung tipe cincin standar. Biasa digunakan di kolam renang atau kapal kecil.')"
      >
      </a-torus>
    </a-scene>

    <script>
      // --- LOGIKA KONTROL & UI ---

      const rig = document.getElementById("rig");
      const btnForward = document.getElementById("btn-forward");
      let isWalking = false;

      // 1. Deteksi apakah user di HP atau PC
      if (
        /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(
          navigator.userAgent
        )
      ) {
        // Jika HP, munculkan tombol maju
        document.getElementById("mobile-controls").style.display = "block";
      }

      // 2. Logika Tombol Maju (HP)
      btnForward.addEventListener("touchstart", (e) => {
        e.preventDefault();
        isWalking = true;
      });
      btnForward.addEventListener("touchend", (e) => {
        e.preventDefault();
        isWalking = false;
      });
      btnForward.addEventListener("mousedown", () => {
        isWalking = true;
      });
      btnForward.addEventListener("mouseup", () => {
        isWalking = false;
      });

      // Loop animasi berjalan
      function walkLoop() {
        if (isWalking) {
          // Ambil arah kamera menghadap
          const cameraEl = document.querySelector("[camera]");
          const angle = cameraEl.object3D.rotation.y + Math.PI;

          // Gerakkan rig ke depan
          const speed = 0.05;
          rig.object3D.position.x += Math.sin(angle) * speed;
          rig.object3D.position.z += Math.cos(angle) * speed;
        }
        requestAnimationFrame(walkLoop);
      }
      walkLoop();

      // 3. Logika Popup Info
      const infoBox = document.getElementById("info-box");
      const titleEl = document.getElementById("info-title");
      const descEl = document.getElementById("info-desc");

      // Fungsi ini dipanggil dari dalam HTML onclick="..."
      window.bukaInfo = function (judul, deskripsi) {
        titleEl.innerText = judul;
        descEl.innerText = deskripsi;
        infoBox.style.display = "block";
      };

      window.tutupInfo = function () {
        infoBox.style.display = "none";
      };

      // Listener klik untuk A-Frame (agar support touch & mouse click)
      document
        .querySelector("a-scene")
        .addEventListener("click", function (evt) {
          // Cek apakah yang diklik punya fungsi onclick custom
          if (
            evt.detail.intersectedEl &&
            evt.detail.intersectedEl.getAttribute("onclick")
          ) {
            // Biarkan event onclick HTML berjalan
          }
        });
    </script>
  </body>
</html>
